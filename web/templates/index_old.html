<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½å¤´ç›”ç›‘æ§ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #1d1d1f;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            animation: fadeInDown 0.6s ease-out;
        }

        .header h1 {
            font-size: 42px;
            font-weight: 700;
            letter-spacing: -0.5px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 18px;
            opacity: 0.9;
            font-weight: 400;
        }

        .status-bar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px 30px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            animation: fadeInUp 0.6s ease-out 0.1s both;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #34c759;
            animation: pulse 2s ease-in-out infinite;
        }

        .status-text {
            font-size: 16px;
            font-weight: 500;
            color: #1d1d1f;
        }

        .last-update {
            font-size: 14px;
            color: #86868b;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            animation: fadeInUp 0.6s ease-out both;
        }

        .card:nth-child(1) { animation-delay: 0.2s; }
        .card:nth-child(2) { animation-delay: 0.3s; }
        .card:nth-child(3) { animation-delay: 0.4s; }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .temp-icon { background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); }
        .humi-icon { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .ppm-icon { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #1d1d1f;
        }

        .card-value {
            font-size: 48px;
            font-weight: 700;
            color: #1d1d1f;
            margin: 10px 0;
            letter-spacing: -1px;
        }

        .card-unit {
            font-size: 24px;
            color: #86868b;
            margin-left: 5px;
        }

        .card-status {
            font-size: 14px;
            color: #34c759;
            font-weight: 500;
        }

        .card-status.warning {
            color: #ff9500;
        }

        .card-status.danger {
            color: #ff3b30;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            animation: fadeInUp 0.6s ease-out 0.5s both;
        }

        .chart-header {
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 24px;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 10px;
        }

        .chart-subtitle {
            font-size: 14px;
            color: #86868b;
        }

        canvas {
            max-height: 400px;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.7;
                transform: scale(1.1);
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 32px;
            }

            .status-bar {
                flex-direction: column;
                gap: 15px;
            }

            .card-value {
                font-size: 36px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>æ™ºèƒ½å¤´ç›”ç›‘æ§ç³»ç»Ÿ</h1>
            <p>å®æ—¶ç¯å¢ƒç›‘æµ‹ä¸æ•°æ®åˆ†æ</p>
        </div>

        <div class="status-bar">
            <div class="status-item">
                <div class="status-dot"></div>
                <span class="status-text">ç³»ç»Ÿè¿è¡Œä¸­</span>
            </div>
            <div class="last-update">
                æœ€åæ›´æ–°: <span id="lastUpdate">--</span>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon temp-icon">ğŸŒ¡ï¸</div>
                    <div class="card-title">æ¸©åº¦</div>
                </div>
                <div class="card-value">
                    <span id="tempValue">--</span><span class="card-unit">Â°C</span>
                </div>
                <div class="card-status" id="tempStatus">æ­£å¸¸</div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-icon humi-icon">ğŸ’§</div>
                    <div class="card-title">æ¹¿åº¦</div>
                </div>
                <div class="card-value">
                    <span id="humiValue">--</span><span class="card-unit">%</span>
                </div>
                <div class="card-status" id="humiStatus">æ­£å¸¸</div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-icon ppm-icon">ğŸ’¨</div>
                    <div class="card-title">çƒŸé›¾æµ“åº¦</div>
                </div>
                <div class="card-value">
                    <span id="ppmValue">--</span><span class="card-unit">ppm</span>
                </div>
                <div class="card-status" id="ppmStatus">æ­£å¸¸</div>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-header">
                <div class="chart-title">å†å²æ•°æ®è¶‹åŠ¿</div>
                <div class="chart-subtitle">æœ€è¿‘æ•°æ®å˜åŒ–æ›²çº¿</div>
            </div>
            <canvas id="dataChart"></canvas>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script>
        // WebSocketè¿æ¥
        const socket = io('http://localhost:5000');

        // å›¾è¡¨é…ç½®
        const ctx = document.getElementById('dataChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    {
                        label: 'æ¸©åº¦ (Â°C)',
                        data: [],
                        borderColor: '#ff6b6b',
                        backgroundColor: 'rgba(255, 107, 107, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 0,
                        pointHoverRadius: 6
                    },
                    {
                        label: 'æ¹¿åº¦ (%)',
                        data: [],
                        borderColor: '#4facfe',
                        backgroundColor: 'rgba(79, 172, 254, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 0,
                        pointHoverRadius: 6
                    },
                    {
                        label: 'çƒŸé›¾æµ“åº¦ (ppm)',
                        data: [],
                        borderColor: '#fa709a',
                        backgroundColor: 'rgba(250, 112, 154, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 0,
                        pointHoverRadius: 6
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                interaction: {
                    intersect: false,
                    mode: 'index'
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                        labels: {
                            font: {
                                size: 14,
                                family: '-apple-system, BlinkMacSystemFont, "Segoe UI"'
                            },
                            padding: 15,
                            usePointStyle: true,
                            pointStyle: 'circle'
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 12,
                        titleFont: {
                            size: 14
                        },
                        bodyFont: {
                            size: 13
                        },
                        cornerRadius: 8
                    }
                },
                scales: {
                    x: {
                        display: true,
                        grid: {
                            display: false
                        },
                        ticks: {
                            maxTicksLimit: 10,
                            font: {
                                size: 12
                            }
                        }
                    },
                    y: {
                        display: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        },
                        ticks: {
                            font: {
                                size: 12
                            }
                        }
                    }
                }
            }
        });

        // æ›´æ–°æ˜¾ç¤ºæ•°æ®
        function updateDisplay(data) {
            // æ›´æ–°æ•°å€¼
            document.getElementById('tempValue').textContent = data.temp.toFixed(1);
            document.getElementById('humiValue').textContent = data.humi.toFixed(1);
            document.getElementById('ppmValue').textContent = data.ppm.toFixed(2);
            document.getElementById('lastUpdate').textContent = data.timestamp;

            // æ›´æ–°çŠ¶æ€
            updateStatus('temp', data.temp, 40);
            updateStatus('humi', data.humi, 80);
            updateStatus('ppm', data.ppm, 100);
        }

        function updateStatus(type, value, threshold) {
            const statusEl = document.getElementById(type + 'Status');
            if (value > threshold) {
                statusEl.textContent = 'âš ï¸ è¶…æ ‡';
                statusEl.className = 'card-status danger';
            } else if (value > threshold * 0.8) {
                statusEl.textContent = 'âš¡ åé«˜';
                statusEl.className = 'card-status warning';
            } else {
                statusEl.textContent = 'âœ“ æ­£å¸¸';
                statusEl.className = 'card-status';
            }
        }

        // æ›´æ–°å›¾è¡¨
        function updateChart(data) {
            const maxPoints = 50; // æœ€å¤šæ˜¾ç¤º50ä¸ªç‚¹

            // æ·»åŠ æ–°æ•°æ®
            chart.data.labels.push(data.timestamp.split(' ')[1]); // åªæ˜¾ç¤ºæ—¶é—´
            chart.data.datasets[0].data.push(data.temp);
            chart.data.datasets[1].data.push(data.humi);
            chart.data.datasets[2].data.push(data.ppm);

            // é™åˆ¶æ•°æ®ç‚¹æ•°é‡
            if (chart.data.labels.length > maxPoints) {
                chart.data.labels.shift();
                chart.data.datasets.forEach(dataset => dataset.data.shift());
            }

            chart.update('none'); // ä¸ä½¿ç”¨åŠ¨ç”»æ›´æ–°ï¼Œæé«˜æ€§èƒ½
        }

        // WebSocketäº‹ä»¶
        socket.on('connect', () => {
            console.log('WebSocketå·²è¿æ¥');
        });

        socket.on('sensor_data', (data) => {
            console.log('æ”¶åˆ°æ•°æ®:', data);
            updateDisplay(data);
            updateChart(data);
        });

        socket.on('disconnect', () => {
            console.log('WebSocketå·²æ–­å¼€');
        });

        // åˆå§‹åŠ è½½å†å²æ•°æ®
        fetch('http://localhost:5000/api/history')
            .then(res => res.json())
            .then(data => {
                if (data.timestamps.length > 0) {
                    const maxPoints = 50;
                    const start = Math.max(0, data.timestamps.length - maxPoints);

                    chart.data.labels = data.timestamps.slice(start).map(t => t.split(' ')[1]);
                    chart.data.datasets[0].data = data.temp.slice(start);
                    chart.data.datasets[1].data = data.humi.slice(start);
                    chart.data.datasets[2].data = data.ppm.slice(start);
                    chart.update();
                }
            })
            .catch(err => console.error('åŠ è½½å†å²æ•°æ®å¤±è´¥:', err));
    </script>
</body>
</html>
